name: Daily Stock Report Bot

on:
  schedule:
    # திங்கள் முதல் வெள்ளி வரை மட்டும் (MON-FRI)
    # காலை 10:00 AM IST (4:30 AM UTC) மற்றும் மதியம் 3:00 PM IST (9:30 AM UTC)
    # 9:20, 9:45 (Email), 10:30, ... 15:00 (Email)
    - cron: '20,45 3 * * 1-5'   # காலை 8:50 (9:20 IST), 9:15 (9:45 IST)
    - cron: '0,45 4-8 * * 1-5'  # 10:15 முதல் 2:15 வரை
    - cron: '30 9 * * 1-5'      # 3:00 PM IST (9:30 UTC)
  workflow_dispatch: # கைமுறையாக இயக்க உதவும்

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4 # புதிய version 4-க்கு மாற்றப்பட்டுள்ளது

      - name: Install uv
        uses: astral-sh/setup-uv@v5 # uv-ஐ நிறுவுகிறது
        with:
          enable-cache: true # அடுத்தடுத்த முறை மிக வேகமாக இயங்க cache செய்யும்

      - name: Set up Python
        run: uv python install 3.10 # குறிப்பிட்ட பைதான் பதிப்பை நிறுவுகிறது

      - name: Install dependencies
        # இது உங்கள் pyproject.toml மற்றும் uv.lock கோப்புகளைப் பயன்படுத்தும்
        # உங்களிடம் uv.lock இல்லையென்றால், முதலில் uv add -r requirements.txt செய்யவும்
        run: uv sync

      - name: Run Python script
        env:
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          ID_INSTANCE: ${{ secrets.ID_INSTANCE }}
          API_TOKEN: ${{ secrets.API_TOKEN }}
          MY_WA_PHONE: ${{ secrets.MY_WA_PHONE }}    # புதிய வரி
          WIFE_WA_PHONE: ${{ secrets.WIFE_WA_PHONE }}
        # 'python' என்பதற்கு பதில் 'uv run' பயன்படுத்துவது சிறந்தது
        run: uv run stock_bot.py
